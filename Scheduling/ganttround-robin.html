<!DOCTYPE html>
<html>
<head>
  <title>
    Gantt Chart - GUI
  </title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> 
</head>

<script>
  /*FCFS SCHEDULING*/

var sequence;
var complete;
var time;
var total;
var proc;
var n;
var at=[];
var bt=[];
var stuff=[];
var index=1;
var Q=[];
var tq;
$(document).ready(function(){
  $('#add').click(function(){
    AddtoList();
  })
  function AddtoList(){
    var arrivalTime=parseInt(document.getElementById("at1").value);
    var burstTime=parseInt(document.getElementById("bt1").value);
    var ioTime=parseInt(document.getElementById("io").value);
    var FinalburstTime=parseInt(document.getElementById("bt2").value);
    var rtj=[];
    rtj.push(burstTime);
    rtj.push(ioTime);
    rtj.push(FinalburstTime);
    console.log(rtj);
    stuff.push({
      "at":arrivalTime,
      "bt1":burstTime,
      "io": ioTime,
      "bt2" : FinalburstTime,
      "check" : parseInt("0"),
      "finish" : parseInt("0"),
      "no":index,
      "rt":rtj,
      "point" : parseInt("0"),
      "wt" : parseInt("0")
    });
    index=index+1;
    console.log(stuff);
    document.getElementById("at1").value="";
    document.getElementById("bt1").value="";
    document.getElementById("io").value="";
    document.getElementById("bt2").value="";
  };
  $('#start').click(function(){
        tq=parseInt(document.getElementById("tq").value);
        console.log(tq);
    rr();
    var i = 0;
  console.log(total);
   console.log(sequence[total].start);
    var totalTime = sequence[total].start;
    pixel = parseInt(800/totalTime);
    console.log("%d---%d\n",totalTime,pixel);
    var containerWidth = pixel*totalTime + 2;
    console.log("containerWidth is %d",containerWidth);
    $('#outer-div').css('width',containerWidth+'px');
    displayBlock(i);
  })
  function rr(){
    var proc=[];
    for(i=0;i<stuff.length;i++){
      proc.push(i+1);
    }
    var n=stuff.length;
    for(i=0;i<n;i++){
      for(j=i+1;j<n;j++){
        if(stuff[i].at>stuff[j].at)
        {
          var temp;
          temp=stuff[i];
          stuff[i]=stuff[j];
          stuff[j]=temp;
        }
      }
    }
    console.log(stuff);
    var time=0;
    var complete=0;
    var temp=null;
    var st_time;
    var first;
    sequence=[];
    var i;
    if(stuff[0].at>0)
    {
      sequence.push({start:time,n:null});
      time+=stuff[0].at;
    }
    Enqueue(0);
    console.log(Q);
    while(complete!=n)
    {
      console.log(Q);
        if(Q.length>0)
          var index=Dequeue();
        else 
        {
          index=null;
          if(temp!=index)
            sequence.push({start: time , n:null});
          console.log(sequence);
          time++;
          for(j=0;j<n;j++)
          {
            if(stuff[j].at<=time && stuff[j].finish==0 && stuff[j].check==0 && Q.indexOf(j)==-1){
              Enqueue(j);
            }
            if( stuff[j],at<=time && stuff[j].check==1)
            {
              stuff[j].rt[1]--;
              if(stuff[j].rt[1]==0)
              {
               stuff[j].check=0;
               stuff[j].point++;
              }
            }
          }
        }
        console.log(index);
        if(index!=null && stuff[index].rt[stuff[index].point]<=tq && stuff[index].finish==0 && stuff[index].check!=1)
        {
          if(stuff[index].point==0)
          {
            var r=stuff[index].rt[stuff[index].point];
            stuff[index].rt[stuff[index].point]=0;
            stuff[index].check=1;
            stuff[index].point++;
            sequence.push({start: time, n: proc[index]});
            console.log(sequence);
            time+=r;
          }
          if(stuff[index].point==2)
          {
            complete++;
            stuff[index].finish=1;
            sequence.push({start:time, n: proc[index]});
            time+=stuff[index].rt[stuff[index].point];
            stuff[index].wt=time-stuff[index].bt1-stuff[index].io-stuff[index].bt2-stuff[index].at;
          }
          temp=index;
          for(j=0;j<n;j++)
          {
            if(stuff[j].at<=time && stuff[j].finish==0 && stuff[j].check==0 && Q.indexOf(j)==-1){
              Enqueue(j);
            }
            if( stuff[j].at<=time && stuff[j].check==1)
            {
              stuff[j].rt[1]--;
              if(stuff[j].rt[1]==0)
              {
               stuff[j].check=0;
               stuff[j].point++;
              }
            }
          }
        }
        if(index!=null && stuff[index].rt[stuff[index].point]>tq && stuff[index].finish==0 && stuff[index].check!=1)
        {
          stuff[index].rt[stuff[index].point]-=tq;
          sequence.push({start:time, n:proc[index]});
          console.log(sequence);
          time+=tq;
          temp=index;
          for(j=0;j<n;j++)
          {
            if(stuff[j].at<=time && stuff[j].finish==0 && stuff[j].check==0 && j!=index && Q.indexOf(j)==-1){
              console.log(j);
              Enqueue(j);
            }
          }
            Enqueue(index);
            console.log(Q);
            for(j=0;j<n;j++)
            {
              if( stuff[j].at<=time && stuff[j].check==1)
              {
               stuff[j].rt[1]--;
               if(stuff[j].rt[1]==0)
                {
                stuff[j].check=0;
                 stuff[j].point++;
                }
              }
            }
          }
        }
    sequence.push({start:time,n:-1});
    console.log(sequence);
    total = sequence.length-1;
    console.log(total);

    var pixel = 0;
  
}
function Enqueue(i){
  Q.push(i);
}
function Dequeue(){
  return Q.shift();
}

  function displayBlock(i){
    if(i == total){
      return;
    }

    var blockWidth = (sequence[i+1].start - sequence[i].start)*pixel;
    var processName = sequence[i].n;
    $('#outer-div').append('<div class="block" id="process-'+sequence[i].start +'">P-'+ sequence[i].n +'<div class="bottom">'+ sequence[i+1].start +'</div></div>');
    $('#process-'+sequence[i].start).css('width',blockWidth);

    $('#process-'+sequence[i].start).fadeIn('slow',function(){
      displayBlock(i+1);
    });

  }
});
</script>
<style>
body{
  text-align: center;
}

#outer-div{
  margin: auto;
  width: 802px;
  height: 100px;
  position: relative;
  border: 1px solid black;
}

.block{
  position: relative;
  display: none;
  border-right: 1px solid black;
  float: left;
  text-align: center;
  background-color: rgba(112, 128, 144, 0.44);
  height: 98px;
}

.bottom{
 /* position: absolute;*/
  width: 100%;
  margin-top: 100px;
  text-align: right;
  margin-bottom: 1;
}
</style>
<body>
  <a href='index.html'><button type='submit'>Back</button></a>
  <h1>
    Round-Robin Scheduling
  </h1>
  <br>
  <h2>
    Gantt Chart
  </h2>
  <br>
  <input type='number' id='at1' placeholder="arrival time"></input>
  <input type='number' id='bt1' placeholder="burst time 1"></input>
  <input type='number' id='io' placeholder="io time"></input>
  <input type='number' id='bt2' placeholder="burst time 2"></input>
  <button id="add" onclick="AddtoList()">Add</button>
  <br>
  <input type='number' id="tq" placeholder="Time quantum"></input> 
  <button id="start">Start</button>
  <br>
  <br>
  <div id="outer-div">
  </div>
</body>
</html>
